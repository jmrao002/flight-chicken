{"ast":null,"code":"import _toConsumableArray from\"/Users/mrao/Code/flight-chicken/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/mrao/Code/flight-chicken/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/mrao/Code/flight-chicken/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/mrao/Code/flight-chicken/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{Jumbotron,Container,Col,Form,Button,Card,CardColumns}from\"react-bootstrap\";// import the mutation we're going to execute\nimport{SAVE_ROUTE}from\"../utils/mutations\";import{useMutation}from\"@apollo/react-hooks\";import Auth from\"../utils/auth\";import{saveroute,searchSkyScannerRoutes}from\"../utils/API\";import{saverouteIds,getSavedrouteIds}from\"../utils/localStorage\";var SearchRoutes=function SearchRoutes(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),searchedroutes=_useState2[0],setSearchedroutes=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),searchInput=_useState4[0],setSearchInput=_useState4[1];var _useState5=useState(getSavedrouteIds()),_useState6=_slicedToArray(_useState5,2),savedrouteIds=_useState6[0],setSavedrouteIds=_useState6[1];var _useMutation=useMutation(SAVE_ROUTE),_useMutation2=_slicedToArray(_useMutation,2),saveroute=_useMutation2[0],error=_useMutation2[1].error;useEffect(function(){return function(){return saverouteIds(savedrouteIds);};});// function to search and to set state\nvar handleFormSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var response,_yield$response$json,items,routeData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(searchInput){_context.next=3;break;}return _context.abrupt(\"return\",false);case 3:_context.prev=3;_context.next=6;return searchSkyScannerRoutes(searchInput);case 6:response=_context.sent;if(response.ok){_context.next=9;break;}throw new Error(\"Something went wrong!\");case 9:_context.next=11;return response.json();case 11:_yield$response$json=_context.sent;items=_yield$response$json.items;routeData=items.map(function(route){var _route$volumeInfo$ima;return{routeId:route.id,authors:route.volumeInfo.authors||[\"No author to display\"],title:route.volumeInfo.title,description:route.volumeInfo.description,image:((_route$volumeInfo$ima=route.volumeInfo.imageLinks)===null||_route$volumeInfo$ima===void 0?void 0:_route$volumeInfo$ima.thumbnail)||\"\"};});setSearchedroutes(routeData);setSearchInput(\"\");_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](3);console.error(_context.t0);case 21:case\"end\":return _context.stop();}}},_callee,null,[[3,18]]);}));return function handleFormSubmit(_x){return _ref.apply(this,arguments);};}();// function to save route and add to state\nvar handleSaveroute=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(routeId){var routeToSave,token,_yield$saveroute,data;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:routeToSave=searchedroutes.find(function(route){return route.routeId===routeId;});token=Auth.loggedIn()?Auth.getToken():null;if(token){_context2.next=4;break;}return _context2.abrupt(\"return\",false);case 4:_context2.prev=4;_context2.next=7;return saveroute({variables:{input:routeToSave}});case 7:_yield$saveroute=_context2.sent;data=_yield$saveroute.data;setSavedrouteIds([].concat(_toConsumableArray(savedrouteIds),[routeToSave.routeId]));_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2[\"catch\"](4);console.error(_context2.t0);case 15:case\"end\":return _context2.stop();}}},_callee2,null,[[4,12]]);}));return function handleSaveroute(_x2){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Jumbotron,{fluid:true,className:\"text-light bg-dark\"},/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"h1\",null,\"Search for routes!\"),/*#__PURE__*/React.createElement(Form,{onSubmit:handleFormSubmit},/*#__PURE__*/React.createElement(Form.Row,null,/*#__PURE__*/React.createElement(Col,{xs:12,md:8},/*#__PURE__*/React.createElement(Form.Control,{name:\"searchInput\",value:searchInput,onChange:function onChange(e){return setSearchInput(e.target.value);},type:\"text\",size:\"lg\",placeholder:\"Search for a route\"})),/*#__PURE__*/React.createElement(Col,{xs:12,md:4},/*#__PURE__*/React.createElement(Button,{type:\"submit\",variant:\"success\",size:\"lg\"},\"Submit Search\")))))),/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"h2\",null,searchedroutes.length?\"Viewing \".concat(searchedroutes.length,\" results:\"):\"Search for a route to begin\"),/*#__PURE__*/React.createElement(CardColumns,null,searchedroutes.map(function(route){return/*#__PURE__*/React.createElement(Card,{key:route.routeId,border:\"dark\"},route.image?/*#__PURE__*/React.createElement(Card.Img,{src:route.image,alt:\"The cover for \".concat(route.title),variant:\"top\"}):null,/*#__PURE__*/React.createElement(Card.Body,null,/*#__PURE__*/React.createElement(Card.Title,null,route.title),/*#__PURE__*/React.createElement(\"p\",{className:\"small\"},\"Authors: \",route.authors),/*#__PURE__*/React.createElement(Card.Text,null,route.description),Auth.loggedIn()&&/*#__PURE__*/React.createElement(Button,{disabled:savedrouteIds===null||savedrouteIds===void 0?void 0:savedrouteIds.some(function(savedrouteId){return savedrouteId===route.routeId;}),className:\"btn-block btn-info\",onClick:function onClick(){return handleSaveroute(route.routeId);}},(savedrouteIds===null||savedrouteIds===void 0?void 0:savedrouteIds.some(function(savedrouteId){return savedrouteId===route.routeId;}))?\"This route has already been saved!\":\"Save this route!\")));}))));};export default SearchRoutes;","map":{"version":3,"sources":["/Users/mrao/Code/flight-chicken/client/src/pages/SearchRoutes.js"],"names":["React","useState","useEffect","Jumbotron","Container","Col","Form","Button","Card","CardColumns","SAVE_ROUTE","useMutation","Auth","saveroute","searchSkyScannerRoutes","saverouteIds","getSavedrouteIds","SearchRoutes","searchedroutes","setSearchedroutes","searchInput","setSearchInput","savedrouteIds","setSavedrouteIds","error","handleFormSubmit","event","preventDefault","response","ok","Error","json","items","routeData","map","route","routeId","id","authors","volumeInfo","title","description","image","imageLinks","thumbnail","console","handleSaveroute","routeToSave","find","token","loggedIn","getToken","variables","input","data","e","target","value","length","some","savedrouteId"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport {\n  Jumbotron,\n  Container,\n  Col,\n  Form,\n  Button,\n  Card,\n  CardColumns,\n} from \"react-bootstrap\";\n// import the mutation we're going to execute\nimport { SAVE_ROUTE } from \"../utils/mutations\";\nimport { useMutation } from \"@apollo/react-hooks\";\nimport Auth from \"../utils/auth\";\nimport { saveroute, searchSkyScannerRoutes } from \"../utils/API\";\nimport { saverouteIds, getSavedrouteIds } from \"../utils/localStorage\";\n\nconst SearchRoutes = () => {\n  const [searchedroutes, setSearchedroutes] = useState([]);\n  const [searchInput, setSearchInput] = useState(\"\");\n\n  const [savedrouteIds, setSavedrouteIds] = useState(getSavedrouteIds());\n\n  const [saveroute, { error }] = useMutation(SAVE_ROUTE);\n\n  useEffect(() => {\n    return () => saverouteIds(savedrouteIds);\n  });\n\n  // function to search and to set state\n  const handleFormSubmit = async (event) => {\n    event.preventDefault();\n\n    if (!searchInput) {\n      return false;\n    }\n\n    try {\n      const response = await searchSkyScannerRoutes(searchInput);\n\n      if (!response.ok) {\n        throw new Error(\"Something went wrong!\");\n      }\n\n      const { items } = await response.json();\n\n      const routeData = items.map((route) => ({\n        routeId: route.id,\n        authors: route.volumeInfo.authors || [\"No author to display\"],\n        title: route.volumeInfo.title,\n        description: route.volumeInfo.description,\n        image: route.volumeInfo.imageLinks?.thumbnail || \"\",\n      }));\n\n      setSearchedroutes(routeData);\n      setSearchInput(\"\");\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  // function to save route and add to state\n  const handleSaveroute = async (routeId) => {\n    const routeToSave = searchedroutes.find(\n      (route) => route.routeId === routeId\n    );\n\n    const token = Auth.loggedIn() ? Auth.getToken() : null;\n\n    if (!token) {\n      return false;\n    }\n\n    try {\n      const { data } = await saveroute({\n        variables: { input: routeToSave },\n      });\n\n      setSavedrouteIds([...savedrouteIds, routeToSave.routeId]);\n    } catch (err) {\n      console.error(err);\n    }\n  };\n\n  return (\n    <>\n      <Jumbotron fluid className=\"text-light bg-dark\">\n        <Container>\n          <h1>Search for routes!</h1>\n          <Form onSubmit={handleFormSubmit}>\n            <Form.Row>\n              <Col xs={12} md={8}>\n                <Form.Control\n                  name=\"searchInput\"\n                  value={searchInput}\n                  onChange={(e) => setSearchInput(e.target.value)}\n                  type=\"text\"\n                  size=\"lg\"\n                  placeholder=\"Search for a route\"\n                />\n              </Col>\n              <Col xs={12} md={4}>\n                <Button type=\"submit\" variant=\"success\" size=\"lg\">\n                  Submit Search\n                </Button>\n              </Col>\n            </Form.Row>\n          </Form>\n        </Container>\n      </Jumbotron>\n\n      <Container>\n        <h2>\n          {searchedroutes.length\n            ? `Viewing ${searchedroutes.length} results:`\n            : \"Search for a route to begin\"}\n        </h2>\n        <CardColumns>\n          {searchedroutes.map((route) => {\n            return (\n              <Card key={route.routeId} border=\"dark\">\n                {route.image ? (\n                  <Card.Img\n                    src={route.image}\n                    alt={`The cover for ${route.title}`}\n                    variant=\"top\"\n                  />\n                ) : null}\n                <Card.Body>\n                  <Card.Title>{route.title}</Card.Title>\n                  <p className=\"small\">Authors: {route.authors}</p>\n                  <Card.Text>{route.description}</Card.Text>\n                  {Auth.loggedIn() && (\n                    <Button\n                      disabled={savedrouteIds?.some(\n                        (savedrouteId) => savedrouteId === route.routeId\n                      )}\n                      className=\"btn-block btn-info\"\n                      onClick={() => handleSaveroute(route.routeId)}\n                    >\n                      {savedrouteIds?.some(\n                        (savedrouteId) => savedrouteId === route.routeId\n                      )\n                        ? \"This route has already been saved!\"\n                        : \"Save this route!\"}\n                    </Button>\n                  )}\n                </Card.Body>\n              </Card>\n            );\n          })}\n        </CardColumns>\n      </Container>\n    </>\n  );\n};\n\nexport default SearchRoutes;\n"]},"metadata":{},"sourceType":"module"}